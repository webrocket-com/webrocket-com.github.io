<div class="contact-form">


	<form method="post" action="{{ site.data.settings.contact_settings.form_action }}" id="contact-form">

		<div class="contact-form__item">
			<label class="contact-form__label">Email Adresse *</label>
			<input type="text" name="email" placeholder="Deine Email Adresse..." class="contact-form__input">
		</div>

		<div class="contact-form__item">
			<label class="contact-form__label">Name *</label>
			<input type="text" name="name" placeholder="Name" class="contact-form__input">
		</div>

		<div class="contact-form__item">
			<label class="contact-form__label">Kategorie *</label>
			<select name="_subject" class="contact-form__input">
				<option value="select" style="display: none;" selected disabled>Auswählen</option>
				<option value="Information">Information</option>
				<option value="Beratungstermin">Beratungstermin</option>
				<option value="Bewerbung">Bewerbung</option>
				<option value="Sonstiges">Sonstiges</option>
			</select>
		</div>

		<div class="contact-form__item">
			<label class="contact-form__label">Nachricht *</label>
			<textarea name="message" placeholder="Deine Nachricht..." class="contact-form__textarea"></textarea>
		</div>

		<input type="hidden" name="_next" value="{{ site.data.settings.contact_settings.confirmation_url }}" />
		<input type="text" name="_gotcha" style="display: none;" class="contact-form__gotcha" val="">

		<div class="g-recaptcha" data-callback="captcha_done" data-sitekey="6LdVU20gAAAAALJaGMSKmyWjP4csUHTRgyJawHLl"></div>

		<div class="contact-form__item">
			<input id="submit-btn" type="submit" value="{{ site.data.settings.contact_settings.send_button_text }}" class="button button--large not-allowed" disabled="disabled">
		</div>

		<div id="form-status"></div>
	</form>

	<script>
		window.onload = () => {
			var el = document.getElementById('g-recaptcha-response');
			if (el) el.setAttribute('required', 'required');
		}

		const captcha_done = () => {
			document.getElementById('submit-btn').removeAttribute('disabled');
			document.getElementById('submit-btn').classList.remove('not-allowed');
		};

		var form = document.getElementById("contact-form");

		async function handleSubmit(event) {
			event.preventDefault();

			var status = document.getElementById("form-status");
			var data = new FormData(event.target);

			fetch(event.target.action, {
				method: form.method,
				body: data,
				headers: {
					'Accept': 'application/json'
				}
			}).then(response => {
				if (response.ok) {
					status.innerHTML = "Danke für deine Nachricht!";
					form.reset();
				} else {
					response.json().then(data => {
						if (Object.hasOwn(data, 'errors')) {
							status.innerHTML = data["errors"].map(error => error["message"]).join(", ");
						} else {
							status.innerHTML = "Hoppla! Beim Senden des Formulars ist ein Problem aufgetreten.";
						}
					});
				}
			}).catch(error => {
				status.innerHTML = "Hoppla! Beim Senden des Formulars ist ein Problem aufgetreten.";
			});
		}

		form.addEventListener("submit", handleSubmit);
	</script>

</div>